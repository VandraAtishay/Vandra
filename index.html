<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Vandra ‚Äî 3D Globe (Fog of War)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Cesium (3D globe) -->
  <link rel="stylesheet" href="https://unpkg.com/cesium@1.120.0/Build/Cesium/Widgets/widgets.css">
  <style>
    html,body,#cesiumContainer { width:100%; height:100%; margin:0; padding:0; overflow:hidden; background:#000; }
    .ui{
      position:absolute; z-index:10; top:12px; left:12px; display:flex; gap:10px; align-items:center; flex-wrap:wrap;
      background:rgba(18,18,18,.85); color:#fff; padding:8px 10px; border-radius:12px; font:14px system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      box-shadow:0 6px 20px rgba(0,0,0,.25);
    }
    .btn{cursor:pointer; background:#5b8cff; color:#fff; border:0; padding:6px 10px; border-radius:8px;}
    .btn.secondary{background:#444;}
    .slider{width:160px;}
    .hint{opacity:.85}
    .toast{position:absolute; right:12px; top:12px; z-index:11; background:#ffebe9; color:#8a1e15; border:1px solid #f0c1b3; padding:8px 10px; border-radius:10px; font:12px/1.3 system-ui; display:none;}
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>

  <div class="ui">
    <label><input id="toggleFog" type="checkbox" checked> Fog on</label>
    <span class="hint">‚Ä¢ Click globe to reveal ‚Ä¢ Radius:</span>
    <input id="radius" class="slider" type="range" min="3" max="120" value="20" />
    <span id="rval" class="hint">20 km</span>
    <button id="gps" class="btn">üìç GPS check-in</button>
    <button id="reset" class="btn secondary">Reset fog</button>
  </div>

  <div id="toast" class="toast"></div>

  <!-- IMPORTANT: set base URL so Cesium can load its workers/assets -->
  <script>window.CESIUM_BASE_URL = "https://unpkg.com/cesium@1.120.0/Build/Cesium/";</script>
  <script src="https://unpkg.com/cesium@1.120.0/Build/Cesium/Cesium.js"></script>
  <script>
    // ---- helpers ----
    const toast = (m)=>{const t=document.getElementById('toast');t.textContent=m;t.style.display='block';setTimeout(()=>t.style.display='none',2500)};

    // geodesic circle (lon,lat,km) -> clockwise ring [ [lng,lat], ... ]
    function geodes
